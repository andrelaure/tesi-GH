{"ast":null,"code":"import { __awaiter, __decorate } from \"tslib\";\nimport __NG_CLI_RESOURCE__0 from \"./notice.component.html?ngResource\";\nimport __NG_CLI_RESOURCE__1 from \"./notice.component.scss?ngResource\";\nimport { Component } from \"@angular/core\";\nimport { ActivatedRoute, Router } from \"@angular/router\";\nimport { Store } from \"@ngrx/store\";\nimport { firstValueFrom, of, Subject } from \"rxjs\";\nimport { debounceTime, distinctUntilChanged, filter, map, startWith, take } from \"rxjs/operators\";\nimport { getRandomId } from \"src/app/redux/actions\";\nimport { selectIsLoading } from \"src/app/redux/awaiter/awaiter.selectors\";\nimport { selectNoticeData, selectNoticeDataFilters } from \"src/app/redux/notice/notice.selectors\";\nimport { changeNoticeDataFilters } from \"src/app/redux/notice/notice.actions\";\nimport { environment } from \"src/environments/environment\";\nlet NoticeComponent = class NoticeComponent {\n  formatDateToDDMMYYYY(date) {\n    date.setDate(date.getDate() + 1); //tomorrow\n    const day = date.getDate().toString().padStart(2, '0');\n    const month = (date.getMonth() + 1).toString().padStart(2, '0');\n    const year = date.getFullYear().toString();\n    return `${day}/${month}/${year}`;\n  }\n  get selectedNoticeData() {\n    return this._selectedNoticeData;\n  }\n  set selectedNoticeData(value) {\n    this._selectedNoticeData = value;\n  }\n  constructor(store, router, route) {\n    this.store = store;\n    this.router = router;\n    this.route = route;\n    this.lastGeneralSearch$ = of(null);\n    this.lastPersonalSearch$ = of(null);\n    this.noticeData$ = of([]);\n    this.noticeDataFilters$ = of({});\n    this.personalTotalRecords$ = of(0);\n    this.generalTotalRecords$ = of(0);\n    this.personalNotices$ = of([]);\n    this.generalNotices$ = of([]);\n    this.expandedMap = {};\n    this.currentDate = new Date();\n    this.formattedDate = this.formatDateToDDMMYYYY(this.currentDate);\n    this._defaultND = {\n      noticeId: 0,\n      noticeState: false,\n      noticeDateTime: \"01012023\",\n      noticeTitle: \"dummy\",\n      noticeObject: \"dummy\",\n      noticeDesc: \"dummy\"\n    };\n    this.globalFiltersFields = Object.keys(this._defaultND);\n    this.filtersSubjPersonal$ = new Subject();\n    this.filtersSubjGeneral$ = new Subject();\n    this._firstQuery = true;\n    this.isLoading$ = store.select(selectIsLoading).pipe(distinctUntilChanged());\n    //this.noticeDataFilters$ = store.select(selectNoticeDataFilters);\n    this.filtersSub = this.filtersSubjPersonal$.asObservable().pipe(debounceTime(1000)).subscribe(a => this.store.dispatch(a));\n    this.filtersSubjGeneral$.asObservable().pipe(debounceTime(1000)).subscribe(a => this.store.dispatch(a));\n    //this.filtersSub = this.filtersSubj$.asObservable().pipe(debounceTime(1000)).subscribe((a) => this.store.dispatch(a));\n    //this.lastGeneralSearch$ = store.select(selectNoticeDataFilters).pipe(take(1), map((f) => f.filtering && f.filtering.length > 0 ? f.filtering[0].value : \"\"));\n    //this.lastPersonalSearch$ = store.select(selectNoticeDataFilters).pipe(take(1), map((f) => f.filtering && f.filtering.length > 0 ? f.filtering[0].value : \"\"));\n    this.noticeData$.subscribe(data => {\n      data.forEach(notice => {\n        this.expandedMap[notice.noticeId] = false;\n      });\n    });\n  }\n  //Personal notices\n  filterPersonal(value) {\n    const newQueryParams = this.getFilteredValue(this.personalNoticeFilters$, 'noticeTitle', value);\n    this.filtersSubjPersonal$.next(changeNoticeDataFilters({\n      queryParams: newQueryParams,\n      _id: getRandomId()\n    }));\n  }\n  sortPersonal($event) {\n    return __awaiter(this, void 0, void 0, function* () {\n      if (this._firstQuery) {\n        this._firstQuery = false;\n        return;\n      }\n      const currentQueryParams = yield firstValueFrom(this.personalNoticeFilters$.pipe(take(1)));\n      const newQueryParams = Object.assign(Object.assign({}, currentQueryParams), {\n        ordering: $event.sortField ? [{\n          column: $event.sortField,\n          columnPrefix: \"\",\n          descending: $event.sortOrder > 0\n        }] : [],\n        paging: currentQueryParams.paging ? $event.first !== null || $event.first !== undefined ? {\n          skip: $event.first,\n          take: $event.rows\n        } : currentQueryParams.paging : {\n          skip: 0,\n          take: environment.defaultNumberOfRowsPerPage\n        }\n      });\n      this.filtersSubjPersonal$.next(changeNoticeDataFilters({\n        queryParams: newQueryParams,\n        _id: getRandomId()\n      }));\n    });\n  }\n  //General notices\n  filterGeneral(value) {\n    const newQueryParams = this.getFilteredValue(this.generalNoticeFilters$, 'noticeTitle', value);\n    this.filtersSubjGeneral$.next(changeNoticeDataFilters({\n      queryParams: newQueryParams,\n      _id: getRandomId()\n    }));\n  }\n  sortGeneral($event) {\n    return __awaiter(this, void 0, void 0, function* () {\n      if (this._firstQuery) {\n        this._firstQuery = false;\n        return;\n      }\n      const currentQueryParams = yield firstValueFrom(this.generalNoticeFilters$.pipe(take(1)));\n      const newQueryParams = Object.assign(Object.assign({}, currentQueryParams), {\n        ordering: $event.sortField ? [{\n          column: $event.sortField,\n          columnPrefix: \"\",\n          descending: $event.sortOrder > 0\n        }] : [],\n        paging: currentQueryParams.paging ? $event.first !== null || $event.first !== undefined ? {\n          skip: $event.first,\n          take: $event.rows\n        } : currentQueryParams.paging : {\n          skip: 0,\n          take: environment.defaultNumberOfRowsPerPage\n        }\n      });\n      this.filtersSubjGeneral$.next(changeNoticeDataFilters({\n        queryParams: newQueryParams,\n        _id: getRandomId()\n      }));\n    });\n  }\n  /*async filter(value: string) {\r\n      const currentQueryParams = await firstValueFrom(this.noticeDataFilters$.pipe(take(1)));\r\n      const newQueryParams: DynamicQueryPart = {\r\n          ...currentQueryParams,\r\n          paging: currentQueryParams.paging\r\n              ? currentQueryParams.paging\r\n              : { skip: 0, take: environment.defaultNumberOfRowsPerPage },\r\n          filtering: value\r\n              ? [{ column: this.globalFiltersFields.join(\",\"), predicate: \"LK\", value: value, kind: \"STRING\" } as Filtering]\r\n              : []\r\n      };\r\n      this.filtersSubj$.next(changeNoticeDataFilters({ queryParams: newQueryParams, _id: getRandomId() }));\r\n  }\r\n    async sort($event: LazyLoadEvent) {\r\n      if (this._firstQuery) {\r\n          this._firstQuery = false;\r\n          return;\r\n      }\r\n      const currentQueryParams = await firstValueFrom(this.noticeDataFilters$.pipe(take(1)));\r\n      const newQueryParams = {\r\n          ...currentQueryParams,\r\n          ordering: $event.sortField\r\n              ? [{ column: $event.sortField, columnPrefix: \"\", descending: $event.sortOrder > 0 }]\r\n              : [],\r\n          paging: currentQueryParams.paging\r\n              ? ($event.first !== null || $event.first !== undefined)\r\n                  ? { skip: $event.first, take: $event.rows }\r\n                  : currentQueryParams.paging\r\n              : { skip: 0, take: environment.defaultNumberOfRowsPerPage }\r\n      };\r\n      this.filtersSubj$.next(changeNoticeDataFilters({ queryParams: newQueryParams, _id: getRandomId() }));\r\n  }\r\n  */\n  toggleRow(noticeId) {\n    this.expandedMap[noticeId] = !this.expandedMap[noticeId];\n  }\n  isRowExpanded(noticeId) {\n    return this.expandedMap[noticeId];\n  }\n  getFilteredValue(filters, column, defaultValue) {\n    const filtering = filters.filtering || [];\n    const noticeTitleFilter = filtering.find(f => f.column === column);\n    return Object.assign(Object.assign({}, filters), {\n      filtering: noticeTitleFilter ? [noticeTitleFilter] : [...(filters.filtering || []), {\n        column,\n        predicate: 'LK',\n        value: defaultValue,\n        kind: 'STRING',\n        prefix: ''\n      } // Aggiungi il campo \"prefix\"\n      ]\n    });\n  }\n\n  ngOnInit() {\n    this.noticeData$ = this.store.select(selectNoticeData).pipe(startWith(this.route.snapshot.data.NoticeData));\n    this.noticeData$.pipe(filter(data => !!data)).subscribe(data => {\n      this.personalNotices$ = of(data.filter(data => data.userId !== null));\n      this.generalNotices$ = of(data.filter(data => data.userId === null));\n      this.personalTotalRecords$ = this.personalNotices$.pipe(map(x => x ? x.length : 0));\n      this.generalTotalRecords$ = this.generalNotices$.pipe(map(x => x ? x.length : 0));\n      this.lastPersonalSearch$ = this.noticeData$.pipe(filter(data => !!data), map(() => this.route.snapshot.data.NoticeData), map(data => data.filter(d => d.userId !== null)), map(notices => notices.reduce((acc, notice) => acc + notice.noticeTitle + ' ', ''), ''));\n      this.lastGeneralSearch$ = this.noticeData$.pipe(filter(data => !!data), map(() => this.route.snapshot.data.NoticeData), map(data => data.filter(d => d.userId === null)), map(notices => notices.reduce((acc, notice) => acc + notice.noticeTitle + ' ', ''), ''));\n      this.personalNoticeFilters$ = this.store.select(selectNoticeDataFilters).pipe(map(filters => this.getFilteredValue(filters, 'noticeTitle', 'noticeTitle')));\n      this.generalNoticeFilters$ = this.store.select(selectNoticeDataFilters).pipe(map(filters => this.getFilteredValue(filters, 'noticeTitle', 'noticeTitle')));\n    });\n  }\n  ngOnDestroy() {\n    var _a;\n    (_a = this.filtersSub) === null || _a === void 0 ? void 0 : _a.unsubscribe();\n  }\n};\nNoticeComponent.ctorParameters = () => [{\n  type: Store\n}, {\n  type: Router\n}, {\n  type: ActivatedRoute\n}];\nNoticeComponent = __decorate([Component({\n  selector: \"app-notice\",\n  template: __NG_CLI_RESOURCE__0,\n  styles: [__NG_CLI_RESOURCE__1]\n})], NoticeComponent);\nexport { NoticeComponent };","map":{"version":3,"mappings":"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","names":["Component","ActivatedRoute","Router","Store","firstValueFrom","of","Subject","debounceTime","distinctUntilChanged","filter","map","startWith","take","getRandomId","selectIsLoading","selectNoticeData","selectNoticeDataFilters","changeNoticeDataFilters","environment","NoticeComponent","formatDateToDDMMYYYY","date","setDate","getDate","day","toString","padStart","month","getMonth","year","getFullYear","selectedNoticeData","_selectedNoticeData","value","constructor","store","router","route","Date","currentDate","noticeId","noticeState","noticeDateTime","noticeTitle","noticeObject","noticeDesc","Object","keys","_defaultND","isLoading$","select","pipe","filtersSub","filtersSubjPersonal$","asObservable","subscribe","a","dispatch","filtersSubjGeneral$","noticeData$","data","forEach","notice","expandedMap","filterPersonal","newQueryParams","getFilteredValue","personalNoticeFilters$","next","queryParams","_id","sortPersonal","$event","_firstQuery","currentQueryParams","ordering","sortField","column","columnPrefix","descending","sortOrder","paging","first","undefined","skip","rows","defaultNumberOfRowsPerPage","filterGeneral","generalNoticeFilters$","sortGeneral","toggleRow","isRowExpanded","filters","defaultValue","filtering","noticeTitleFilter","find","f","predicate","kind","prefix","ngOnInit","snapshot","NoticeData","personalNotices$","userId","generalNotices$","personalTotalRecords$","x","length","generalTotalRecords$","lastPersonalSearch$","d","notices","reduce","acc","lastGeneralSearch$","ngOnDestroy","unsubscribe","selector","template"],"sourceRoot":"","sources":["C:\\Users\\andrea\\Desktop\\SIGLA\\tesi\\tesi-andrea-lauretta\\front-end\\angular\\src\\app\\components\\notice\\notice.component.ts"],"sourcesContent":["import { Component, OnDestroy, OnInit } from \"@angular/core\";\r\nimport { ActivatedRoute, Router } from \"@angular/router\";\r\nimport { Action, Store } from \"@ngrx/store\";\r\nimport { firstValueFrom, Observable, of, Subject, Subscription } from \"rxjs\";\r\nimport { debounceTime, distinctUntilChanged, filter, map, startWith, take } from \"rxjs/operators\";\r\nimport { LazyLoadEvent } from \"primeng/api\";\r\n\r\n\r\nimport { AppState, DynamicQueryPart, Filtering } from \"src/app/redux/state\";\r\nimport { getRandomId } from \"src/app/redux/actions\";\r\nimport { selectIsLoading } from \"src/app/redux/awaiter/awaiter.selectors\";\r\nimport { NoticeData } from \"src/app/redux/notice/notice.state\";\r\nimport { selectNoticeData, selectNoticeDataFilters } from \"src/app/redux/notice/notice.selectors\";\r\nimport { changeNoticeDataFilters } from \"src/app/redux/notice/notice.actions\";\r\nimport { environment } from \"src/environments/environment\";\r\n\r\n\r\n@Component({\r\n    selector: \"app-notice\",\r\n    templateUrl: \"./notice.component.html\",\r\n    styleUrls: [\"./notice.component.scss\"],\r\n})\r\n\r\nexport class NoticeComponent implements OnInit, OnDestroy{\r\n    lastGeneralSearch$: Observable<string> = of(null);\r\n    lastPersonalSearch$: Observable<string> = of(null);\r\n    noticeData$: Observable<NoticeData[]> = of([]);\r\n    noticeDataFilters$: Observable<DynamicQueryPart> = of({});\r\n    isLoading$: Observable<boolean>;\r\n\r\n    personalTotalRecords$: Observable<number> = of(0);\r\n    generalTotalRecords$: Observable<number> = of(0);\r\n\r\n    personalNotices$: Observable<NoticeData[]> = of([]);\r\n    generalNotices$: Observable<NoticeData[]> = of([]);\r\n\r\n    personalNoticeFilters$: Observable<DynamicQueryPart>;\r\n    generalNoticeFilters$: Observable<DynamicQueryPart>;\r\n    \r\n    expandedMap: { [key: number]: boolean } = {};\r\n\r\n    currentDate = new Date();\r\n    formattedDate = this.formatDateToDDMMYYYY(this.currentDate);\r\n\r\n    private formatDateToDDMMYYYY(date: Date): string {\r\n        date.setDate(date.getDate()+1);  //tomorrow\r\n        const day = date.getDate().toString().padStart(2, '0'); \r\n        const month = (date.getMonth() + 1).toString().padStart(2, '0');\r\n        const year = date.getFullYear().toString();\r\n      \r\n        return `${day}/${month}/${year}`;\r\n      }\r\n\r\n    private _defaultND: Partial<NoticeData> = {\r\n        noticeId: 0,\r\n        noticeState: false,\r\n        noticeDateTime: \"01012023\",\r\n        noticeTitle: \"dummy\",\r\n        noticeObject: \"dummy\",\r\n        noticeDesc: \"dummy\",\r\n    };\r\n    \r\n    globalFiltersFields = Object.keys(this._defaultND);\r\n    filtersSubjPersonal$ = new Subject<Action>();\r\n    filtersSubjGeneral$ = new Subject<Action>();\r\n    filtersSub: Subscription;\r\n\r\n    private _firstQuery: boolean = true;\r\n    private _selectedNoticeData: NoticeData;\r\n    get selectedNoticeData() {\r\n        return this._selectedNoticeData;\r\n    }\r\n    set selectedNoticeData(value: NoticeData) {\r\n        this._selectedNoticeData = value;\r\n    }\r\n\r\n    constructor(\r\n        private store: Store<AppState>,\r\n        private router: Router,\r\n        private route: ActivatedRoute\r\n    ){\r\n        this.isLoading$ = store.select(selectIsLoading).pipe(distinctUntilChanged());\r\n        //this.noticeDataFilters$ = store.select(selectNoticeDataFilters);\r\n        this.filtersSub = this.filtersSubjPersonal$.asObservable().pipe(debounceTime(1000)).subscribe((a) => this.store.dispatch(a));\r\n        this.filtersSubjGeneral$.asObservable().pipe(debounceTime(1000)).subscribe((a) => this.store.dispatch(a));\r\n        //this.filtersSub = this.filtersSubj$.asObservable().pipe(debounceTime(1000)).subscribe((a) => this.store.dispatch(a));\r\n        //this.lastGeneralSearch$ = store.select(selectNoticeDataFilters).pipe(take(1), map((f) => f.filtering && f.filtering.length > 0 ? f.filtering[0].value : \"\"));\r\n        //this.lastPersonalSearch$ = store.select(selectNoticeDataFilters).pipe(take(1), map((f) => f.filtering && f.filtering.length > 0 ? f.filtering[0].value : \"\"));\r\n        this.noticeData$.subscribe((data) => { data.forEach((notice) => {this.expandedMap[notice.noticeId] = false })});\r\n    }\r\n\r\n\r\n    //Personal notices\r\n    filterPersonal(value: string) {\r\n        const newQueryParams = this.getFilteredValue(this.personalNoticeFilters$, 'noticeTitle', value);\r\n        this.filtersSubjPersonal$.next(changeNoticeDataFilters({ queryParams: newQueryParams, _id: getRandomId() }));\r\n    }\r\n    \r\n    async sortPersonal($event: LazyLoadEvent) {\r\n        if (this._firstQuery) {\r\n            this._firstQuery = false;\r\n            return;\r\n        }\r\n        const currentQueryParams = await firstValueFrom(this.personalNoticeFilters$.pipe(take(1)));\r\n        const newQueryParams = {\r\n            ...currentQueryParams,\r\n            ordering: $event.sortField\r\n                ? [{ column: $event.sortField, columnPrefix: \"\", descending: $event.sortOrder > 0 }]\r\n                : [],\r\n            paging: currentQueryParams.paging\r\n                ? ($event.first !== null || $event.first !== undefined)\r\n                    ? { skip: $event.first, take: $event.rows }\r\n                    : currentQueryParams.paging\r\n                : { skip: 0, take: environment.defaultNumberOfRowsPerPage }\r\n        };\r\n    \r\n        this.filtersSubjPersonal$.next(changeNoticeDataFilters({ queryParams: newQueryParams, _id: getRandomId() }));\r\n    }\r\n\r\n\r\n    //General notices\r\n    filterGeneral(value: string) {\r\n        const newQueryParams = this.getFilteredValue(this.generalNoticeFilters$, 'noticeTitle', value);\r\n        this.filtersSubjGeneral$.next(changeNoticeDataFilters({ queryParams: newQueryParams, _id: getRandomId() }));\r\n    }\r\n    \r\n    async sortGeneral($event: LazyLoadEvent) {\r\n        if (this._firstQuery) {\r\n            this._firstQuery = false;\r\n            return;\r\n        }\r\n        const currentQueryParams = await firstValueFrom(this.generalNoticeFilters$.pipe(take(1)));\r\n        const newQueryParams = {\r\n            ...currentQueryParams,\r\n            ordering: $event.sortField\r\n                ? [{ column: $event.sortField, columnPrefix: \"\", descending: $event.sortOrder > 0 }]\r\n                : [],\r\n            paging: currentQueryParams.paging\r\n                ? ($event.first !== null || $event.first !== undefined)\r\n                    ? { skip: $event.first, take: $event.rows }\r\n                    : currentQueryParams.paging\r\n                : { skip: 0, take: environment.defaultNumberOfRowsPerPage }\r\n        };\r\n    \r\n        this.filtersSubjGeneral$.next(changeNoticeDataFilters({ queryParams: newQueryParams, _id: getRandomId() }));\r\n    }\r\n    /*async filter(value: string) {\r\n        const currentQueryParams = await firstValueFrom(this.noticeDataFilters$.pipe(take(1)));\r\n        const newQueryParams: DynamicQueryPart = {\r\n            ...currentQueryParams,\r\n            paging: currentQueryParams.paging\r\n                ? currentQueryParams.paging\r\n                : { skip: 0, take: environment.defaultNumberOfRowsPerPage },\r\n            filtering: value\r\n                ? [{ column: this.globalFiltersFields.join(\",\"), predicate: \"LK\", value: value, kind: \"STRING\" } as Filtering]\r\n                : []\r\n        };\r\n        this.filtersSubj$.next(changeNoticeDataFilters({ queryParams: newQueryParams, _id: getRandomId() }));\r\n    }\r\n\r\n    async sort($event: LazyLoadEvent) {\r\n        if (this._firstQuery) {\r\n            this._firstQuery = false;\r\n            return;\r\n        }\r\n        const currentQueryParams = await firstValueFrom(this.noticeDataFilters$.pipe(take(1)));\r\n        const newQueryParams = {\r\n            ...currentQueryParams,\r\n            ordering: $event.sortField\r\n                ? [{ column: $event.sortField, columnPrefix: \"\", descending: $event.sortOrder > 0 }]\r\n                : [],\r\n            paging: currentQueryParams.paging\r\n                ? ($event.first !== null || $event.first !== undefined)\r\n                    ? { skip: $event.first, take: $event.rows }\r\n                    : currentQueryParams.paging\r\n                : { skip: 0, take: environment.defaultNumberOfRowsPerPage }\r\n        };\r\n        this.filtersSubj$.next(changeNoticeDataFilters({ queryParams: newQueryParams, _id: getRandomId() }));\r\n    }\r\n    */\r\n\r\n    toggleRow(noticeId: number) {\r\n        this.expandedMap[noticeId] = !this.expandedMap[noticeId];\r\n    }\r\n\r\n    isRowExpanded(noticeId: number): boolean {\r\n        return this.expandedMap[noticeId];\r\n    }\r\n\r\n    private getFilteredValue(filters: DynamicQueryPart, column: string, defaultValue: any): DynamicQueryPart {\r\n        const filtering = filters.filtering || [];\r\n        const noticeTitleFilter = filtering.find(f => f.column === column);\r\n    \r\n        return {\r\n            ...filters,\r\n            filtering: noticeTitleFilter ? [noticeTitleFilter] : [\r\n                ...(filters.filtering || []),\r\n                { column, predicate: 'LK', value: defaultValue, kind: 'STRING', prefix: '' } // Aggiungi il campo \"prefix\"\r\n            ]\r\n        };\r\n    }  \r\n    \r\n\r\n    ngOnInit(): void {\r\n        this.noticeData$ = this.store.select(selectNoticeData).pipe(startWith(this.route.snapshot.data.NoticeData));\r\n        this.noticeData$.pipe(\r\n            filter(data => !!data)\r\n        ).subscribe((data) => {\r\n            this.personalNotices$ = of(data.filter((data) => data.userId !== null));\r\n            this.generalNotices$ = of(data.filter((data) => data.userId === null));            \r\n\r\n            this.personalTotalRecords$ = this.personalNotices$.pipe(map((x) => (x ? x.length : 0)));\r\n            this.generalTotalRecords$ = this.generalNotices$.pipe(map((x) => (x ? x.length : 0)));\r\n\r\n            this.lastPersonalSearch$ = this.noticeData$.pipe(\r\n                filter(data => !!data),\r\n                map(() => this.route.snapshot.data.NoticeData),\r\n                map(data => data.filter(d => d.userId !== null)),\r\n                map(notices => notices.reduce((acc, notice) => acc + notice.noticeTitle + ' ', ''), '')\r\n            );\r\n        \r\n            this.lastGeneralSearch$ = this.noticeData$.pipe(\r\n                filter(data => !!data),\r\n                map(() => this.route.snapshot.data.NoticeData),\r\n                map(data => data.filter(d => d.userId === null)),\r\n                map(notices => notices.reduce((acc, notice) => acc + notice.noticeTitle + ' ', ''), '')\r\n            );\r\n\r\n            this.personalNoticeFilters$ = this.store.select(selectNoticeDataFilters).pipe(\r\n                map(filters => this.getFilteredValue(filters, 'noticeTitle', 'noticeTitle'))\r\n            );\r\n        \r\n            this.generalNoticeFilters$ = this.store.select(selectNoticeDataFilters).pipe(\r\n                map(filters => this.getFilteredValue(filters, 'noticeTitle', 'noticeTitle'))\r\n            );\r\n        });\r\n    }\r\n\r\n    ngOnDestroy(): void {\r\n        this.filtersSub?.unsubscribe();\r\n    }\r\n}\r\n\r\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}