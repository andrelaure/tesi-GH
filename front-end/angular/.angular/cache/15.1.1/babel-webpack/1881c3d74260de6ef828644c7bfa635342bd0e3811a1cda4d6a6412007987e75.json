{"ast":null,"code":"import { __awaiter, __decorate } from \"tslib\";\nimport __NG_CLI_RESOURCE__0 from \"./noticesManagement.component.html?ngResource\";\nimport __NG_CLI_RESOURCE__1 from \"./noticesManagement.component.scss?ngResource\";\nimport { Component } from \"@angular/core\";\nimport { Store } from \"@ngrx/store\";\nimport { selectNoticeData, selectNoticeDataFilters } from \"src/app/redux/notice/notice.selectors\";\nimport { changeNoticeDataFilters, sendNoticeData, deleteNoticeData } from \"src/app/redux/notice/notice.actions\";\nimport { environment } from \"src/environments/environment\";\nimport { of } from \"rxjs/internal/observable/of\";\nimport { ActivatedRoute, Router } from \"@angular/router\";\nimport { Subject, debounceTime, distinctUntilChanged, firstValueFrom, map, startWith, take } from \"rxjs\";\nimport { getRandomId } from \"src/app/redux/actions\";\nimport { selectIsLoading } from \"src/app/redux/awaiter/awaiter.selectors\";\nlet NoticesManagementComponent = class NoticesManagementComponent {\n  get selectedNoticeData() {\n    return this._selectedNoticeData;\n  }\n  set selectedNoticeData(value) {\n    this._selectedNoticeData = value;\n  }\n  constructor(store, router, route) {\n    //this.noticeData$ = store.select(selectNoticeData);\n    this.store = store;\n    this.router = router;\n    this.route = route;\n    this.noticeData$ = of([]);\n    this.notification = {\n      noticeState: false,\n      noticeDateTime: '01012023',\n      noticeTitle: '',\n      noticeObject: '',\n      noticeDesc: '',\n      userId: null\n    };\n    this.usersId = [{\n      usersId: \"Utente 1\"\n    }, {\n      usersId: \"Utente 2\"\n    }, {\n      usersId: \"Utente 3\"\n    }, {\n      usersId: \"Utente 4\"\n    }, {\n      usersId: \"Utente 5\"\n    }, {\n      usersId: \"Utente 6\"\n    }];\n    this.selectedUsers = [];\n    this.successAdd = false;\n    this.successUpdate = false;\n    // notices table\n    this.lastSearch$ = of(null);\n    this.noticeDataFilters$ = of({});\n    this.totalRecords$ = of(0);\n    this.expandedMap = {};\n    this.globalFiltersFields = Object.keys(this.notification);\n    this.filtersSubj$ = new Subject();\n    this.showAddFrom = true;\n    this._firstQuery = true;\n    //notices table\n    this.noticeData$ = store.select(selectNoticeData).pipe(startWith(route.snapshot.data.NoticeData));\n    this.isLoading$ = store.select(selectIsLoading).pipe(distinctUntilChanged());\n    this.noticeDataFilters$ = store.select(selectNoticeDataFilters);\n    this.filtersSub = this.filtersSubj$.asObservable().pipe(debounceTime(1000)).subscribe(a => this.store.dispatch(a));\n    this.lastSearch$ = store.select(selectNoticeDataFilters).pipe(take(1), map(f => f.filtering && f.filtering.length > 0 ? f.filtering[0].value : \"\"));\n    this.noticeData$.subscribe(data => {\n      data.forEach(notice => {\n        this.expandedMap[notice.noticeId] = false;\n      });\n    });\n    this.totalRecords$ = this.noticeData$.pipe(map(x => x ? x[0] ? x[0].count : 0 : 0));\n  }\n  addNoticeData(form) {\n    if (this.selectedUsers.length > 0) {\n      const selectedUsersIds = this.selectedUsers.map(user => user.usersId);\n      const usersIdAsString = selectedUsersIds.join(\", \");\n      this.notification.userId = usersIdAsString;\n    }\n    //add to db\n    this.store.dispatch(sendNoticeData({\n      item: this.notification,\n      _id: getRandomId()\n    }));\n    //console.log(\"Notifica aggiunta:\", this.notification);\n    this.resetFormFields(form);\n    this.successAdd = true;\n  }\n  resetFormFields(form) {\n    form.resetForm();\n    this.notification = {\n      noticeState: false,\n      noticeDateTime: \"01012023\",\n      noticeTitle: \"\",\n      noticeObject: \"\",\n      noticeDesc: \"\",\n      userId: null\n    };\n    this.selectedUsers = [];\n  }\n  deleteNoticeData(notice) {\n    if (notice) {\n      this.store.dispatch(deleteNoticeData({\n        item: notice,\n        _id: getRandomId()\n      }));\n    }\n    //reload pagina o form tabella\n  }\n\n  updateNoticeData(form) {\n    if (this.selectedUsers.length > 0) {\n      const selectedUsersIds = this.selectedUsers.map(user => user.usersId);\n      const usersIdAsString = selectedUsersIds.join(\", \");\n      this.notification.userId = usersIdAsString;\n    }\n    //add to db\n    this.store.dispatch(sendNoticeData({\n      item: this.notification,\n      _id: getRandomId()\n    }));\n    //console.log(\"Notifica aggiunta:\", this.notification);\n    this.resetFormFields(form);\n    this.successUpdate = true;\n    //reload tabella\n  }\n  //notices table functions\n  filter(value) {\n    return __awaiter(this, void 0, void 0, function* () {\n      const currentQueryParams = yield firstValueFrom(this.noticeDataFilters$.pipe(take(1)));\n      const newQueryParams = Object.assign(Object.assign({}, currentQueryParams), {\n        paging: currentQueryParams.paging ? currentQueryParams.paging : {\n          skip: 0,\n          take: environment.defaultNumberOfRowsPerPage\n        },\n        filtering: value ? [{\n          column: this.globalFiltersFields.join(\",\"),\n          predicate: \"LK\",\n          value: value,\n          kind: \"STRING\"\n        }] : []\n      });\n      this.filtersSubj$.next(changeNoticeDataFilters({\n        queryParams: newQueryParams,\n        _id: getRandomId()\n      }));\n    });\n  }\n  sort($event) {\n    return __awaiter(this, void 0, void 0, function* () {\n      if (this._firstQuery) {\n        this._firstQuery = false;\n        return;\n      }\n      const currentQueryParams = yield firstValueFrom(this.noticeDataFilters$.pipe(take(1)));\n      const newQueryParams = Object.assign(Object.assign({}, currentQueryParams), {\n        ordering: $event.sortField ? [{\n          column: $event.sortField,\n          columnPrefix: \"\",\n          descending: !$event.sortOrder\n        }] //come cazzo cambio l'ordineeeeee\n        : [],\n        paging: currentQueryParams.paging ? $event.first !== null || $event.first !== undefined ? {\n          skip: $event.first,\n          take: $event.rows\n        } : currentQueryParams.paging : {\n          skip: 0,\n          take: environment.defaultNumberOfRowsPerPage\n        }\n      });\n      this.filtersSubj$.next(changeNoticeDataFilters({\n        queryParams: newQueryParams,\n        _id: getRandomId()\n      }));\n    });\n  }\n  toggleRow(noticeId) {\n    this.expandedMap[noticeId] = !this.expandedMap[noticeId];\n  }\n  isRowExpanded(noticeId) {\n    return this.expandedMap[noticeId];\n  }\n  ngOnInit() {}\n  ngOnDestroy() {\n    var _a;\n    (_a = this.filtersSub) === null || _a === void 0 ? void 0 : _a.unsubscribe();\n  }\n};\nNoticesManagementComponent.ctorParameters = () => [{\n  type: Store\n}, {\n  type: Router\n}, {\n  type: ActivatedRoute\n}];\nNoticesManagementComponent = __decorate([Component({\n  selector: \"app-noticesManagement\",\n  template: __NG_CLI_RESOURCE__0,\n  styles: [__NG_CLI_RESOURCE__1]\n})], NoticesManagementComponent);\nexport { NoticesManagementComponent };","map":{"version":3,"mappings":"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","names":["Component","Store","selectNoticeData","selectNoticeDataFilters","changeNoticeDataFilters","sendNoticeData","deleteNoticeData","environment","of","ActivatedRoute","Router","Subject","debounceTime","distinctUntilChanged","firstValueFrom","map","startWith","take","getRandomId","selectIsLoading","NoticesManagementComponent","selectedNoticeData","_selectedNoticeData","value","constructor","store","router","route","noticeState","noticeDateTime","noticeTitle","noticeObject","noticeDesc","userId","usersId","Object","keys","notification","noticeData$","select","pipe","snapshot","data","NoticeData","isLoading$","noticeDataFilters$","filtersSub","filtersSubj$","asObservable","subscribe","a","dispatch","lastSearch$","f","filtering","length","forEach","notice","expandedMap","noticeId","totalRecords$","x","count","addNoticeData","form","selectedUsers","selectedUsersIds","user","usersIdAsString","join","item","_id","resetFormFields","successAdd","resetForm","updateNoticeData","successUpdate","filter","currentQueryParams","newQueryParams","paging","skip","defaultNumberOfRowsPerPage","column","globalFiltersFields","predicate","kind","next","queryParams","sort","$event","_firstQuery","ordering","sortField","columnPrefix","descending","sortOrder","first","undefined","rows","toggleRow","isRowExpanded","ngOnInit","ngOnDestroy","unsubscribe","selector","template"],"sourceRoot":"","sources":["C:\\Users\\andrea\\Desktop\\SIGLA\\tesi\\tesi-andrea-lauretta\\front-end\\angular\\src\\app\\components\\admin\\noticesManagement\\noticesManagement.component.ts"],"sourcesContent":["import { Component, OnDestroy, OnInit } from \"@angular/core\";\r\nimport { NgForm } from \"@angular/forms\";\r\n\r\nimport { AppState, DynamicQueryPart, Filtering } from \"src/app/redux/state\";\r\nimport { Action, Store } from \"@ngrx/store\";\r\n\r\nimport { NoticeData } from \"src/app/redux/notice/notice.state\";\r\nimport { selectNoticeData, selectNoticeDataFilters } from \"src/app/redux/notice/notice.selectors\";\r\nimport { changeNoticeDataFilters, sendNoticeData, deleteNoticeData, updateNoticeData } from \"src/app/redux/notice/notice.actions\";\r\nimport { environment } from \"src/environments/environment\";\r\nimport { of } from \"rxjs/internal/observable/of\";\r\nimport { ActivatedRoute, Router } from \"@angular/router\";\r\nimport { Observable, Subject, Subscription, count, debounceTime, distinctUntilChanged, filter, firstValueFrom, map, startWith, take } from \"rxjs\";\r\nimport { getRandomId } from \"src/app/redux/actions\";\r\nimport { selectIsLoading } from \"src/app/redux/awaiter/awaiter.selectors\";\r\nimport { LazyLoadEvent } from \"primeng/api/lazyloadevent\";\r\n\r\n\r\n@Component({\r\n    selector: \"app-noticesManagement\",\r\n    templateUrl: \"./noticesManagement.component.html\",\r\n    styleUrls: [\"./noticesManagement.component.scss\"],    \r\n})\r\n\r\nexport class NoticesManagementComponent implements OnInit, OnDestroy { \r\n\r\n    noticeData$: Observable<NoticeData[]> = of([]);\r\n\r\n    notification: Partial<NoticeData> = {\r\n        noticeState: false,\r\n        noticeDateTime: '01012023',\r\n        noticeTitle: '',\r\n        noticeObject: '',\r\n        noticeDesc: '',\r\n        userId: null,\r\n      };\r\n\r\n    usersId: any[] = [  //to fill with keyclock users\r\n        { usersId: \"Utente 1\" },\r\n        { usersId: \"Utente 2\" },\r\n        { usersId: \"Utente 3\" },\r\n        { usersId: \"Utente 4\" },\r\n        { usersId: \"Utente 5\" },\r\n        { usersId: \"Utente 6\" },\r\n    ];\r\n\r\n    selectedUsers: any[] = [];\r\n    successAdd: boolean = false;\r\n    successUpdate: boolean = false;\r\n\r\n\r\n    // notices table\r\n    lastSearch$: Observable<string> = of(null);\r\n    noticeDataFilters$: Observable<DynamicQueryPart> = of({});\r\n    isLoading$: Observable<boolean>;\r\n    totalRecords$: Observable<number> = of(0);\r\n    \r\n    expandedMap: { [key: number]: boolean } = {};\r\n    \r\n    globalFiltersFields = Object.keys(this.notification);\r\n    filtersSubj$ = new Subject<Action>();\r\n    filtersSub: Subscription;\r\n    showAddFrom = true;\r\n\r\n    private _firstQuery: boolean = true;\r\n    private _selectedNoticeData: NoticeData;\r\n    get selectedNoticeData() {\r\n        return this._selectedNoticeData;\r\n    }\r\n    set selectedNoticeData(value: NoticeData) {\r\n        this._selectedNoticeData = value;\r\n    }\r\n\r\n    constructor(\r\n        private store: Store<AppState>,\r\n        private router: Router,\r\n        private route: ActivatedRoute\r\n    ){\r\n        //this.noticeData$ = store.select(selectNoticeData);\r\n\r\n        //notices table\r\n        this.noticeData$ = store.select(selectNoticeData).pipe(startWith(route.snapshot.data.NoticeData));\r\n        this.isLoading$ = store.select(selectIsLoading).pipe(distinctUntilChanged());\r\n        this.noticeDataFilters$ = store.select(selectNoticeDataFilters);\r\n        this.filtersSub = this.filtersSubj$.asObservable().pipe(debounceTime(1000)).subscribe((a) => this.store.dispatch(a));\r\n        this.lastSearch$ = store.select(selectNoticeDataFilters).pipe(take(1), map((f) => f.filtering && f.filtering.length > 0 ? f.filtering[0].value : \"\"));\r\n        this.noticeData$.subscribe((data) => { data.forEach((notice) => {this.expandedMap[notice.noticeId] = false })});\r\n        this.totalRecords$ = this.noticeData$.pipe(map((x) => (x ? (x[0] ? x[0].count : 0) : 0)));\r\n    }\r\n\r\n\r\n    addNoticeData(form: NgForm) {\r\n        if (this.selectedUsers.length > 0) {\r\n            const selectedUsersIds: string[] = this.selectedUsers.map((user) => user.usersId);\r\n            const usersIdAsString: string = selectedUsersIds.join(\", \");\r\n            this.notification.userId = usersIdAsString;\r\n        }\r\n        //add to db\r\n        this.store.dispatch( sendNoticeData({ item: this.notification, _id: getRandomId() }) );\r\n        //console.log(\"Notifica aggiunta:\", this.notification);\r\n    \r\n        this.resetFormFields(form);\r\n        this.successAdd = true;\r\n    }\r\n\r\n    resetFormFields(form: NgForm) {\r\n        form.resetForm();\r\n        this.notification = {\r\n            noticeState: false,\r\n            noticeDateTime: \"01012023\",\r\n            noticeTitle: \"\",\r\n            noticeObject: \"\",\r\n            noticeDesc: \"\",\r\n            userId: null,\r\n        };\r\n        this.selectedUsers = [];\r\n    }\r\n\r\n\r\n    deleteNoticeData(notice:NoticeData){\r\n        if (notice){\r\n            this.store.dispatch( deleteNoticeData({item: notice, _id: getRandomId() }));\r\n        }\r\n        //reload pagina o form tabella\r\n    }\r\n\r\n\r\n    updateNoticeData(form: NgForm){\r\n        if (this.selectedUsers.length > 0) {\r\n            const selectedUsersIds: string[] = this.selectedUsers.map((user) => user.usersId);\r\n            const usersIdAsString: string = selectedUsersIds.join(\", \");\r\n            this.notification.userId = usersIdAsString;\r\n        }\r\n        //add to db\r\n        this.store.dispatch( sendNoticeData({ item: this.notification, _id: getRandomId() }) );\r\n        //console.log(\"Notifica aggiunta:\", this.notification);\r\n    \r\n        this.resetFormFields(form);\r\n        this.successUpdate = true;\r\n        //reload tabella\r\n    }\r\n\r\n\r\n    //notices table functions\r\n    \r\n    async filter(value: string) {\r\n        const currentQueryParams = await firstValueFrom(this.noticeDataFilters$.pipe(take(1)));\r\n        const newQueryParams: DynamicQueryPart = {\r\n            ...currentQueryParams,\r\n            paging: currentQueryParams.paging\r\n                ? currentQueryParams.paging\r\n                : { skip: 0, take: environment.defaultNumberOfRowsPerPage },\r\n            filtering: value\r\n                ? [{ column: this.globalFiltersFields.join(\",\"), predicate: \"LK\", value: value, kind: \"STRING\" } as Filtering]\r\n                : []\r\n        };\r\n        this.filtersSubj$.next(changeNoticeDataFilters({ queryParams: newQueryParams, _id: getRandomId() }));\r\n    }\r\n\r\n    async sort($event: LazyLoadEvent) {\r\n        if (this._firstQuery) {\r\n            this._firstQuery = false;\r\n            return;\r\n        }\r\n        const currentQueryParams = await firstValueFrom(this.noticeDataFilters$.pipe(take(1)));\r\n        const newQueryParams = {\r\n            ...currentQueryParams,\r\n            ordering: $event.sortField\r\n                ? [{ column: $event.sortField, columnPrefix: \"\", descending: !$event.sortOrder }] //come cazzo cambio l'ordineeeeee\r\n                : [],\r\n            paging: currentQueryParams.paging\r\n                ? ($event.first !== null || $event.first !== undefined)\r\n                    ? { skip: $event.first, take: $event.rows }\r\n                    : currentQueryParams.paging\r\n                : { skip: 0, take: environment.defaultNumberOfRowsPerPage }\r\n        };\r\n        this.filtersSubj$.next(changeNoticeDataFilters({ queryParams: newQueryParams, _id: getRandomId() }));\r\n    }\r\n    \r\n\r\n    toggleRow(noticeId: number) {\r\n        this.expandedMap[noticeId] = !this.expandedMap[noticeId];\r\n    }\r\n\r\n    isRowExpanded(noticeId: number): boolean {\r\n        return this.expandedMap[noticeId];\r\n    }\r\n          \r\n\r\n\r\n    ngOnInit(): void { }\r\n\r\n    ngOnDestroy(): void {\r\n        this.filtersSub?.unsubscribe();\r\n    }\r\n}\r\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}